mot_cl√©,post_et_reponses
blackbox_exporter http probe,"hey all! i know there have been tons of posts like this on here, but this is one of my first times sitting down and designing a network from scratch and i am hoping to get some feedback on it. i have tried to incorporate some feedback that others have received here as ive planned this out. first of all, a couple of guiding principles that i have tried to stick by here 1. dont tie subnets to vlans, allow each to grow organically and separately. 2. do distinguish sites based on the second octet. 3. do make vlans scalable to future sites regardless of their size within reason. 4. do allow some room to breathe. 5. do keep it as simple as possible, but not at the expense of security. a couple of questions that i have 1. does it make sense to dedicate a vlan for backup devices? this seems like a good security measure. 2. where am i best off placing monitoring probes andor jump boxes from a security standpoint? 3. is there anything here i am going to regret a couple years from now? thanks in advance! i welcome and look forward to any feedback you might have for me here. site prefix vlan structure 1xx infrastructure management, servers, etc. 2xx user devices workstations, printers, etc. 3xx security systems access controls, cameras, etc. 4xx iotbuilding control 4000 guest subnets management subnet vlan 100 fortilink subnet vlan 102 justification fortilink requires a dedicated vlan but giving it a routable one allows us to monitor switches. wap management subnet vlan 104 justification ubiquiti access points call home to a controller that will have internet access. the management vlan will be oob and will not have internet access. virtual hosts subnet vlan 110 justification the vhost software connects to the internet regularly for updates. it makes sense to have this segregated for security reasons, while still allowing outbound internet access. servers subnet vlan 111 manageddomainjoined workstations subnet vlan 200 printers subnet vlan 210 voip subnet vlan 220 access controls subnet vlan 300 cameras subnet vlan 302 iot subnet vlan 400 smart tvapple tv subnet vlan 401 justification apple tvs are connected to from the managed workstation and guest vlan for screen sharing and control purposes. it makes sense to separate from iot so that the iot vlan can be more restrictive. guest subnet vlan 4000 || weve done this very similar setups for many years now at all of our sites, and theres nothing wrong with it. if its what your org requires it will work fine. but at my org were starting to swing the other way. push as much out of the local sites as possible and into cloud services and reduce, reduce, reduce. one subnet if possible. simple routing. cloud managed everything. it makes troubleshooting and equipment purchasing easier. sure we lose some control, but we also dont have to troubleshoot a bunch of stuff either and can refocus our time onto projects that really need it. || this is just ip design but seems fine if you can remember the vlan numbers and ip address blocks go with it. can you explain your apple tv setup a bit more are you going to have pcs living in that same subnet? your gonna have a bad time crossing vlan boundaries. || idk if its been said, but i like naming my vlans off the 3rd octet. makes remembering things easy and if anyone else joins your team helps to get them onboard pretty fast too. just a thought. edit i plea ignorance. i posted before reading. i think it depends on the size of your network, but i dont really see a bad reason to label clans off the subnets. maybe others can chime in and explain this? || i dont care what you do and how you do and when you do it, theres only one rule in my book documentation trumps all! as long as you do that, you can do whatever the hell you want if it suits your style of it and works for the company! but since you already started planning ahead of things, i figure you will do that just fine the thing im not seeing here are dmz vlans, just in case you need them. i would go 172.something for those to separate them at the glance of an eye from regular internal vlans, like your guest vlan. how are you gonna terminate all your vlans? if thats on a security device like a big ass fortigate, think about zones as well and traffic flow. make a diagram with your eastwest and northsouth traffic. are there any functional wishes from the server department? assuming that isnt you also. || the only thing i would question is if some of the subnets need to be 24, but honestly, i feel like the best thing is that it makes sense to you. || do keep it as simple as possible, but not at the expense of security. this is as simple as possible? looks waaaaay over designed."
blackbox_exporter http probe,"hi everyboy! ive bought 2 nics for our little lab. we have 2 proxmox nodes, and with the first one everything went ok, the kernel module ixgbe is loaded and the new device is listed with ip link. but doing the same with the second server ive found the following problem kernel ixgbe intelr 10 gigabit pci express network driver kernel ixgbe copyright c 19992016 intel corporation. kernel ixgbe 00000900.0 00000900.0 uninitialized packet buffer0 can not provide enoughheadroom to support flow control.decrease mtu or number of traffic classes kernel ixgbe 00000900.0 adapter removed kernel ixgbe 00000900.0 hw init failed 5 kernel ixgbe probe of 00000900.0 failed with error 5 i have no idea about how to solve it, so hopefully here is an expert who deserves heaven and who will be able to help me. please! for more info, thats a proxmox node with the following network configuration auto lo iface lo inet loopback iface enp8s0 inet manual mtu 1280 auto vmbr0 iface vmbr0 inet manual bridgeports enp8s0 bridgestp off bridgefd 0 bridgevlanaware yes bridgevids 24094 auto vmbr0.2 iface vmbr0.2 inet static address gateway and there is a few kubernetes nodes inside. if more info is needed just ask for it, please. || ixgbe520 drivers are wonky in a lot of the kernel packages. id see if you can shoehorn the intel drivers into it instead."
blackbox_exporter http probe,"hi, i am having an issue while roaming in our office with windows laptops with intel wireless nics ax201, ax211. usually there are 23 packet lost while roaming to another ap. android devices roams much smoother 01 packet lost. no coverage holes. i did a pcap on my windows laptop and observed this behavior after roaming 1. first packets are dhcp requestack 2. arp requestreply of gateway ip 3. then we see some icmp requests, arp probes. 4. arp announcment of my ip 5. another arp request of gateway ip 6, 19 icmp replies and arp reply of step 5 12 steps takes about 40ms 35 steps takes about 5 seconds what is most interesting is that all those 19 icmp echo reply packets and arp reply is received at the same time. all packets arriving at the same microsecond. so actually there is no packet loss, it just delayed for 5 seconds while icmp reply packets does not reach in time, there is almost no delay for broadcast packets like dhcp and arp. tried to search for similar issues and noticed that packet coalescing does something like this, but disabling it did not make any improvement. tested with and drivers. my guess is that intel nic is doing something like caching, because it is impossible that all those 20 frames are comming to the nic over the air at the same time,. has anyone got an idea what is happening here? || what type of authentication are you using on your wireless? what wifi system are you using? || do you have 802.11ax turned on?"
blackbox_exporter http probe,"hello rnetworking, never posted here before but trying to figure out a dns issue that has been stumping me for a few days. one of our sites is having inconsistencies when trying to reach a certain carrier site of ours i work in insurance. the confusing part is that sometimes the site can be accessed fine. then on the same internet connectiondns server, a random amount of time later, it cant be. then a random amount of time later, it can be accessed again. the site trying to be reached is and when its not working, chrome spits back the error dnsprobefinishednxdomain. i changed the dns servers in use by the affected site to match a site that doesnt have an issue, and the inconsistency is persisting. ive also tried classic steps like ipconfig renew and ipconfig flushdns. i believe its an issue with our internal dns somewhere, because the second i switch an affected computer to the issues go away. but part of me also hopes that it could be an issue with our isps dns servers or something? im not the best at this kind of stuff so trying to learn a lot while working through this, and any guidance would be greatly appreciated. thank you! || well that nxdomain error means the dns server didnt resolve an ip address to that fqdn. in a cmd shell, continually typing this command and point it towards your dns servers. nslookup sbr5.foragentsonly.com 10.x.x.x obviously change 10.x.x.x to your internal dns server. see if it sometimes errors out on your internal dns server, if does then you likely have an issue with that dns server. || is the error really about sbr5.foragentsonly.com? open your browsers developer tools press f12, the reload the page. you might get the hints you need from there. || i know this post is a couple months old, but i wanted to reach out because i have a client who is having exactly this same issue, with the same address sbr5.foragentsonly.com. through some testing with nslookup, weve found that the root issue is that the windows dns server is sometimes not able to resolve the address, but its very intermittent. as you noted, computers dont have this issue when set to use 8.8.8.8, but obviously the dns servers cant stay set this way in an ad environment. the windows dns server configuration itself is very normal, without any outoftheordinary customizations or settings, and i havent been able to find any errors in logs. we dont have issues resolving any other address, ever. the one thing i did notice that seems strange, and may somehow be related to the issue, is that has an insanely low ttl of 30 seconds. while i dont believe a low ttl like this would inherently cause issues, ive also never seen it suggested to be so low for a public dns record, and ive never seen it in practice in my entire career. not only that, but i also wonder if the ttl is having whatever effect was intended by setting it so low, because there is a record in the chain that has a 6 hour ttl sbr5.foragentsonly.com 30 sec sbr5.foragentsonly.com.edgekey.net 6 hrs e174018.dscx.akamaiedge.net 20 sec. the only possible workaround i can think of is for us to set up local zones for these records and define them ourselves instead. obviously, this is a solution that will cause more harm than good in the long run, because as soon as one of the records updates to a new value, things are going to break and were going to need to update the record. we have reached out to progressive for support, and of course their engineers insist that this is an issue with our dns server configuration. i do suspect this might be a quirk or bug with windows dns server, perhaps related to the low ttl, but i havent been able to find any discussion about similar issues. and again, this is a very standard configuration with no issues resolving other addresses."
blackbox_exporter http probe,"i have a cisco 4321 im trying to get bgp to pair with another router i have set up over a gre tunnel. the tunnel is up and active, and i can ping the gre ip on the other side just fine. i have the following config for the cisco router bgp 65501 bgp logneighborchanges neighbor 10.1.0.2 remoteas 64975 neighbor 10.1.0.2 updatesource tunnel100 ! addressfamily ipv4 network 10.2.0.1 neighbor 10.1.0.2 activate neighbor 10.1.0.2 prefixlist bgpallowall out exitaddressfamily ! ip forwardprotocol nd ip http server ip http authentication local ip http secureserver ip tftp sourceinterface gigabitethernet0 ! ip ssh version 2 ! ! ip prefixlist bgpallowall seq 5 permit 0.0.0.00 le 32 but when i check the status of bgp im just seeing neighbor v as msgrcvd msgsent tblver inq outq updown statepfxrcd 10.1.0.2 4 64975 0 0 1 0 0 never idle which tells me its never connected. what am i missing ?? the tunnel100 shows ttcedmvpnsh ip interface tunnel100 tunnel100 is up, line protocol is up internet address is 10.1.0.124 broadcast address is 255.255.255.255 address determined by setup command mtu is 1300 bytes helper address is not set directed broadcast forwarding is disabled outgoing common access list is not set outgoing access list is not set inbound common access list is not set inbound access list is not set proxy arp is enabled local proxy arp is disabled security level is default split horizon is disabled icmp redirects are never sent icmp unreachables are always sent icmp mask replies are never sent ip fast switching is enabled ip flow switching is disabled ip cef switching is enabled ip cef switching turbo vector ip null turbo vector associated unicast routing topologies topology base, operation state is up ip multicast fast switching is enabled ip multicast distributed fast switching is disabled ip routecache flags are fast, cef router discovery is disabled ip output packet accounting is disabled ip access violation accounting is disabled tcpip header compression is disabled rtpip header compression is disabled probe proxy name replies are disabled policy routing is disabled network address translation is disabled bgp policy mapping is disabled input features mci check, tcp adjust mss output features tcp adjust mss post encapsulation features ipsec postencap output classification ipv4 wccp redirect outbound is disabled ipv4 wccp redirect inbound is disabled ipv4 wccp redirect exclude is disabled || based on the two config you posted, the ass dont line up and this will prevent the neighbour coming up. you have cisco local as 65501, remote as 64975 other router local as 65005, remote as 65501 i think on the other router the local as i think is configured twice, as 64975 in the first i assume global section of the json, and then 65505 in the neighbour section. the ass need to match, so change the local as of the other router, or remote as of the cisco, depending upon which the correct as is meant to be. || ebgp multihop? || dont you need to have a null route to your networks? || can you post the relevant config for the remote side as well? || here is the config from the other side gre section gre tunnels 0 id 00000000604d3518897c0483691ac5f6, devicetype tun, dhcpenabled false, enabled true, exceptionroutemode route, failbackto , failoverto , keepaliveenabled false, keepaliveperiod 10, keepaliveretries 3, key 1234, localnetwork 10.0.0.2, name ttc gre, nemo false, netmask 255.255.255.0, pmtud true, remotegateway 65.132.237.231, remotenetwork 10.0.0.1, routes , ttl 64, tunnelsourcelan null, wandev disabled, wantriggerfield uid, wantriggerpredicate is, wantriggervalue , 1 id 00000001604d3518897c0483691ac5f6, devicetype tun, dhcpenabled false, enabled true, exceptionroutemode route, failbackto , failoverto , keepaliveenabled false, keepaliveperiod 10, keepaliveretries 3, key 456, localnetwork 10.1.0.2, name ttce gre, nemo false, netmask 255.255.255.0, pmtud true, remotegateway 65.132.237.229, remotenetwork 10.1.0.1, routes , ttl 64, tunnelsourcelan null, wandev disabled, wantriggerfield uid, wantriggerpredicate is, wantriggervalue || other side bgp bgp section bgp routers 0 asn 64975, ebgprequirepolicy false, enabled true, multipathrelax false, name txxxxrtr0002, neighbors 0 advertisementinterval 1, defaultoriginate false, disableconnectedcheck false, dontcapabilitynegotiate false, ipaddress 192.168.0.3 192.168.0.0, localasnoprepend false, localasnoprependreplaceas false, nexthopself false, nexthopselfall false, nocommunity false, overridecapability false, peergroupmode 0, remoteas 65000, routereflectorclient false, softreconfiguration false, strictcapabilitymatch false, timersconnect 5, timersholdtime 3, timerskeepaliveinterval 1 , 1 defaultoriginate false, disableconnectedcheck false, dontcapabilitynegotiate false, ipaddress 10.0.0.1, localas 65005, localasnoprepend false, localasnoprependreplaceas false, nexthopself false, nexthopselfall false, nocommunity false, overridecapability false, peergroupmode 0, remoteas 65501, routemapout 00000001ff5232168522db6bf2e4ce04, routereflectorclient false, softreconfiguration false, strictcapabilitymatch false , 2 defaultoriginate false, disableconnectedcheck false, dontcapabilitynegotiate false, ipaddress 10.1.0.1, localas 65005, localasnoprepend false, localasnoprependreplaceas false, nexthopself false, nexthopselfall false, nocommunity false, overridecapability false, peergroupmode 0, remoteas 65501, routemapout 00000001ff5232168522db6bf2e4ce04, routereflectorclient false, softreconfiguration false, strictcapabilitymatch false , networks 0 aggregate false, aggregateasset false, aggregatesummary false, ipnetwork 192.168.0.024 , redistribute , routerid 192.168.0.1 192.168.0.0, timersholdtime 20, timerskeepaliveinterval 5 ,"
blackbox_exporter http probe,"learnt from the text book we are familiar with the sawtooth pattern of tcp transmission where cwnd grow up and packet loss occurs aqm or other reason then cwnd drops. after that cwnd keeps increasing again until another packet loss occurs, hence a sawtooth pattern of cwnd is displayed, no matter you use cubic or newreno as cc algorithm. i am verifying this using tcpprobe on a mobilephone cubic as cc. basically enable the linux kernel tracing of tcpprobe and perform an iperf3 uploading.but here is what i caught x axis is time in second. the top curve with dot in olive color shows the change of inflight packets along the time. the inflight seems to be a clear reverse sawtooth, where a sudden increase of packet injection then gradually reduce due to receiving further acks. also the cwnd then never changes and stay at a constant level. my question are of three folds 1. according to what i learn about the linux kernel, whenever an ack is received which indicates a release of transmission window, it will check if there are any packet available to send why here it does not send immediately, instead wait for tens of ms to send out a burst. and importantly, there is obvious a change of such behavior because before 61417 seconds, it sent out packet without any hesitation. what leads to this change. buffer level? 2. i notice this curve when i test with both rmnetcellular network and wlan0wifi. i havent test with eth yet. is this pattern related to wireless transceiver only? or its a behavior related to iperf3? 3. i make some investigation and i have a feeling that this is related to traffic shaping. but i have no further idea how this pattern is caused. || shot in the dark are you capturing data on the sending machine? if so, the vertical component could be an impossibly large write thats actually buffered downstream of where youre capturing the data, perhaps in some network offload feature of the nic, radio, or whatever. so, you see a single huge write vertical line, infinite speed, but that blob of data is actually released as many tcp segments, over a long time window youre not seeing because of whatevers happening downstream. the sloped bit of the sawtooth reduction of inflight data is due to acks from the other end reacting to the individual segments which you never saw as they roll in, oneatatime. || as others pointed out it could very well be a buffering, hardware offload thing. you measured using the kernel traces? to avoid these errors in my studies we built a lab that had an external observer of traffic using optical splitters fiber connection. this observer then did a packet capture and hardware timestamping at the nic so data was as accurate as possible || my two cents traffic shaping would makes sense regarding misaligned delays in transmission between tcp and the shaper, although the capture location impacts how the data is presented. traffic policing makes more sense for sawtoothing behavior or shaping with a small buffer."
blackbox_exporter http probe,"long story short new domain just registered. well call it the a record currently points to a site that reports the domain is parked, but this hasnt filtered through yet and its been nearly 36 hours? most dns servers are still reporting it not found. ive set a cname call it which ive set to point to a dynamic dns service which then points to my firewall, which then routes a particular port call it port 888 to an internal web server with port forwarding. the dynamic dns service is working fine and i can browse to the web server using that ddns address. however, the cname record isnt being resolved, despite the fact that i think the cname has propagated successfully almost all out of 25ish dns servers report it correctly. i can even resolve the cname with an nslookup command, but the root domain a record doesnt resolve. my issue is this when i use a web browser to connect to with an nslookup. im reaching the limit of my knowledge here, but will a browser not even try to attempt to resolve any subdomains if the root domain doesnt have an a record published? is that why its failing to resolve, or should a cname be resolved even if the a record isnt found? || dig is your friend. we cant tell you cos youre not telling us the name. || will a browser not even try to attempt to resolve any subdomains if the root domain doesnt have an a record published no it shouldnt care. || cname will only respond with an ip address, only if the a record that the cname points to exists. if there is no a record theres no way to see it. now if you use nslookup you can do nslookup q cname this should show what the cname request is. also dig could be used too. || is this on a shared hosting plan? the parking page maybe the default route for the website and the hoster is unaware of the domain you are trying to cname. || does your browser have secure dns enabled? || the tld matters. .com registry updates are near instantaneous these days, im not sure about .org if thats actually the tld. x200b after 36 hours though id say the nameservers are not set correctly. is this a split horizon dns issue? are you using this internally and externally? what does mxtoolbox say? || or i dont trust nslookup for anything external."
blackbox_exporter http probe,"weve had some voip phones for over a year now, and weve never been able to get the time synced up properly on them. after trying to correct the error on the cloud management panel, the dhcp server, and even contacting our isp to make sure their exchange was broadcasting the right time, i gave up long ago and just set the handsets time manually. so today i conducted an audit of our security and was looking through the layer 3 filters that were set some time ago. i remember blocking them based on the sans institute commonly probed ports paper and thought id check for an updated copy for any new ports deemed outright vulnerable since then. thats when i saw it. port 123 controls the network time protocol. no. it couldnt be... i disabled the rule and within seconds all the voip handsets flashed at once with the correct time. i couldnt believe it. im almost 30 and never used a device or application that uses port 123 instead of a request. i feel like a twit. when i told my colleague, he pointed out that the engineer who invented port 123 mustve been british as thats the number you dial to get the talking clock in the uk, which led to a cool conversation about port origins and 666. obviously ive set up mitigations for this nowvulnerable open port but a few things to learn from my stupidity 1 review your firewall rules regularly. 2 when documenting firewall rules, make sure one of the columns in your sheet notes what the portapplication layer was intended to do. looking at a vague list of numbers and moving onto the next thing is too easy. || youre winding us up here right? || i feel like there is still a misunderstanding here that should be corrected. 123 is a port, like 80 and 443. is an application protocol, it can run on 80443 or other ports. youve used devices and applications which used something other than you just didnt know it. || what did i waste time reading here?"
blackbox_exporter http probe,"hello networking, ill be replacing our load balancers a10 beginningmid next year, and i am starting to take a look at the possible solutions. ill be looking at something that could do lbaas as we have a lot of demands for test vips, change to healthmonitorprobe, etc... that could be done directly by the internal requester. we have more that 500 vip, usually pretty simple exposed to the internet for some services that are used by our external clients. i used to have a10 in my previous job and had many issues upgrades, routing, bugs, ressources exhaustion, and it seems to be the same here i joined recently, so i really want to explore other solutions, and possibly account for future scalability, i had an avi presentation not so long ago and it seemed interesting in terms of spinning up new nodes to scale. was wondering what youre using and for which scenarios ? thanks ! ||  || 4 nodes with haproxy ecmp, each vip gets pushed as 32 route to the rest of the network. few gigabits, maybe 100ks connections in peak. servers got few years now but still plenty of reserve. just a linux box so it is easy to integrate with rest of our cm infrastructure || it sounds like youre looking for multitenancy. avi, f5 and a10 all support multitenancy to some degree. maybe netscaler and someone else does too. as a general rule, watch out for rbac, integration with ldap and scalability in terms of number of tenants. depending on how you want to work, you may directly expose the gui of your load balancer to the users, handle everything via rest api calls, or design a simplified portal talking to the load balancer via api and exposing the main functions. in the latter cases, you also want a solid, mature rest interface. || we use the vm from || if just loadbalancer nginx if loadbalancer with more features is needed f5 bigip platform more features could be web application firewall, cache, compression, mfa, and many more || we have hundreds of a10 deployed, both virtual and appliances. never had much issue with them especially when it comes to bugs."
blackbox_exporter http probe,"im trying to make a remote mirroring working but im not sure if im doing it right. first, let me explain if i understand monitoregress vs reflectorport as i understand it, monitoregress is my trunkuplink to my remote switch and reflectorport is only use if im doing local mirroring. im right or wrong? my pcap only show broadcast from the network im monitoring not the client im monitoring even if i generate traffic like icmp or in this case, the client is a network printer. x200b configuration on the source switch mirroringgroup 1 remotesource mirroringgroup 1 remoteprobe vlan 99 mirroringgroup 1 monitoregress g 1052 interface gigabitethernet1016 stp disable mirroringgroup 1 mirroringport both x200b configuration on the destination switch mirroringgroup 1 remotesource mirroringgroup 1 remoteprobe vlan 99 interface gigabitethernet3014 stp disable mirroringgroup 1 monitorport || "
